{% extends 'base.html' %}

{% block head %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/detail2.css' %}">
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/diagrama.css' %}"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <title>Edición Manual</title>
{% endblock %}

{% block content %}
    <div class="main-cont animate__animated animate__fadeIn">

      <header class="head-cont">
        <div class="logo">
          <img src="{% static 'images/aeto.svg' %}" alt="logo aeto">
        </div>

        <h1 class="main-title">Edición manual</h1>
      </header>

      <main class="main__container">
        <div class="config__container">
         
          <div class="relative">
            <div class="absolute">

              {% for eje in ejes %}

                {% if eje|length == 2 %}

                  <div class="par-llantas ejes__{{cant_ejes|safe}}">
                    <div class="tire" data-tire-id="{{eje.0.0.id}}">
                      <div class="tire__top {{eje.0.3}}">
                        <span class="tire__data">
                          {{eje.0.0.presion_de_salida}}
                        </span>
                      </div>

                      <div class="tire__medium {{eje.0.3}}">
                        <span class="tire__data">
                          {{eje.0.0.posicion}}
                        </span>
                      </div>
                      
                      <span class="icon-tire2"></span>
                      
                      <div class="tire__bottom {{eje.0.1}}">
                          <span class="tire__data">
                            
                            {% if eje.0.0.ultima_inspeccion == None %}
                              N/A
                            {% else %}
                              {{eje.0.0.ultima_inspeccion.min_profundidad}}
                            {% endif %}
                            
                          </span>
                      </div>
                    </div>
            
                    <div class="axle">
                      <span class="axle-white"></span>
                    </div>
            
                    <div class="tire" data-tire-id="{{eje.1.0.id}}">
                      <div class="tire__top {{eje.1.3}}">
                        <span class="tire__data">
                          {{eje.1.0.presion_de_salida}}
                        </span>
                      </div>

                      <div class="tire__medium {{eje.1.3}}">
                        <span class="tire__data">
                          {{eje.1.0.posicion}}
                        </span>
                      </div>
                      
                      <span class="icon-tire2"></span>
                      
                      <div class="tire__bottom {{eje.1.1}}">
                          <span class="tire__data">

                            {% if eje.1.0.ultima_inspeccion == None %}
                              N/A
                            {% else %}
                              {{eje.1.0.ultima_inspeccion.min_profundidad}}
                            {% endif %}

                          </span>
                      </div>
                    </div>
                  </div>

                {% else %}

                  <div class="par-doble-llanta ejes__{{cant_ejes|safe}}">
                    <div class="double-tire">
                      <div class="tire" data-tire-id="{{eje.0.0.id}}">
                        <div class="tire__top {{eje.0.3}}">
                          <span class="tire__data">
                            {{eje.0.0.presion_de_salida}}
                          </span>
                        </div>

                        <div class="tire__medium {{eje.0.3}}">
                          <span class="tire__data">
                            {{eje.0.0.posicion}}
                          </span>
                        </div>
                        
                        <span class="icon-tire2"></span>
                        
                        <div class="tire__bottom {{eje.0.1}}">
                            <span class="tire__data">
                              
                              {% if eje.0.0.ultima_inspeccion == None %}
                                N/A
                              {% else %}
                                {{eje.0.0.ultima_inspeccion.min_profundidad}}
                              {% endif %}

                            </span>
                        </div>
                      </div>
                      <div class="tire" data-tire-id="{{eje.1.0.id}}">
                        <div class="tire__top {{eje.1.3}}">
                          <span class="tire__data">
                            {{eje.1.0.presion_de_salida}}
                          </span>
                        </div>

                        <div class="tire__medium {{eje.1.3}}">
                          <span class="tire__data">
                            {{eje.1.0.posicion}}
                          </span>
                        </div>
                        
                        <span class="icon-tire2"></span>
                        
                        <div class="tire__bottom {{eje.1.1}}">
                            <span class="tire__data">

                              {% if eje.1.0.ultima_inspeccion == None %}
                                N/A
                              {% else %}
                                {{eje.1.0.ultima_inspeccion.min_profundidad}}
                              {% endif %}
                              
                            </span>
                        </div>
                      </div>
                    </div>
            
                    <div class="axle"></div>
            
                    <div class="double-tire">
                      <div class="tire" data-tire-id="{{eje.2.0.id}}">
                        <div class="tire__top {{eje.2.3}}">
                          <span class="tire__data">
                            {{eje.2.0.presion_de_salida}}
                          </span>
                        </div>

                        <div class="tire__medium {{eje.2.3}}">
                          <span class="tire__data">
                            {{eje.2.0.posicion}}
                          </span>
                        </div>
                        
                        <span class="icon-tire2"></span>
                        
                        <div class="tire__bottom {{eje.2.1}}">
                            <span class="tire__data">
                              
                              {% if eje.2.0.ultima_inspeccion == None %}
                                N/A
                              {% else %}
                                {{eje.2.0.ultima_inspeccion.min_profundidad}}
                              {% endif %}

                            </span>
                        </div>
                      </div>
                      <div class="tire" data-tire-id="{{eje.3.0.id}}">
                        <div class="tire__top {{eje.3.3}}">
                          <span class="tire__data">
                            {{eje.3.0.presion_de_salida}}
                          </span>
                        </div>

                        <div class="tire__medium {{eje.3.3}}">
                          <span class="tire__data">
                            {{eje.3.0.posicion}}
                          </span>
                        </div>
                        
                        <span class="icon-tire2"></span>
                        
                        <div class="tire__bottom {{eje.3.1}}">
                            <span class="tire__data">
                              
                              {% if eje.3.0.ultima_inspeccion == None %}
                                N/A
                              {% else %}
                                {{eje.3.0.ultima_inspeccion.min_profundidad}}
                              {% endif %}

                            </span>
                        </div>
                      </div>
                    </div>
                  </div>

                {% endif %}

              {% endfor %}

            </div>
          </div>

        </div>

        <div class="forms__container">
          <div class="form__container">
            <details>
              <summary>
                Vehículo
              </summary>
              <form action="" class="form__wrapper" style="display: flex;">
  
                <!-- Start input -->
                <div class="form__group field">
                  <input
                    class="form__field"
                    type="text"
                    placeholder="vehiculo"
                    name="vehiculo"
                    autocomplete="off"
                    value="100"
                  />
                  <label for="vehiculo" class="form__label">
                    KM de vehículo
                  </label>
                </div>
                <!-- End input -->
  
                <nav class="flex-row">
                  <button type="submit" class="btn btn-success disabled">
                    <span class="icon-checkmark"></span>
                  </button>
                </nav>
              </form>
            </details>
          </div>
  
          <form class="form__container" method="POST">
            {% for eje in ejes %}
              {% for ej in eje %}
              
                <div class="form__wrapper" id="tire-form" data-item-id="{{ej.0.id}}">
                  
                {% if ej.4 > 1 %}
                <!-- Start input -->
                <div class="form__group field">
                  <input
                    class="form__field"
                    type="text"
                    placeholder="economico"
                    name="economico"
                    autocomplete="off"
                    value = "{{ej.2.numero_economico.value}}"
                    readonly
                  />
                  <label for="economico" class="form__label">
                    Número económico
                  </label>
                </div>
                
                <!-- End input -->
                {% else %}
                  <!-- Start input -->
                  <div class="form__group field">
                    <input
                      class="form__field"
                      type="text"
                      placeholder="economico"
                      name="economico"
                      autocomplete="off"
                      value = "{{ej.2.numero_economico.value}}"
                    />
                    <label for="economico" class="form__label">
                      Número económico
                    </label>
                  </div>
                  
                  <!-- End input -->
              {% endif %}

                  <!-- Start input -->
                  <div class="form__group field">
                    <input
                      class="form__field"
                      type="text"
                      placeholder="producto"
                      name="producto"
                      autocomplete="off"
                      list="producto"
                      value = "{{ej.0.producto}}"
                      
                    />
                    <label for="producto" class="form__label">
                      Producto
                    </label>
                    <datalist id="producto">
                      
                      {% for i in ej.2.producto %}
                    
                          <option value="{{i.data.label}}">{{i.data.label}}</option>

                      {% endfor %}
              
                    </datalist>
                  </div>
                  <!-- End input -->
      
                  <!-- Start input -->
                  <div class="form__group field">
                    <input
                      class="form__field"
                      type="text"
                      placeholder="vida"
                      name="vida"
                      autocomplete="off"
                      list="vida"
                      value = {{ej.2.vida.value}}
                    />
                    <label for="vida" class="form__label">
                      Vida
                    </label>
                    <datalist id="vida">

                      {% for i in ej.2.vida %}
                    
                          <option value="{{i.data.label}}">{{i.data.label}}</option>

                      {% endfor %}

                    </datalist>
                  </div>
                  <!-- End input -->
      
                  <!-- Start input -->
                  <div class="form__group field">
                    <input
                      class="form__field"
                      type="number"
                      placeholder="montado"
                      name="montado"
                      autocomplete="off"
                      {% if ej.2.km_montado.value == None %}
                        
                      {% else %}
                        value = {{ej.2.km_montado.value}}
                      {% endif %}
                      
                    />
                    <label for="montado" class="form__label">
                      KM de montado
                    </label>
                  </div>
                  <!-- End input -->
                  
                  <!-- Start input -->
                  {% if ej.0.ultima_inspeccion == None %}
                    <input
                    class="form__field"
                    type="number"
                    placeholder="profundidad"
                    name="profundidad"
                    autocomplete="off"
                    value="None"
                    style="display: None"
                  />
                  {% else %}
                  
                    <div class="form__group field">
                      <input
                        class="form__field"
                        type="number"
                        placeholder="profundidad"
                        name="profundidad"
                        autocomplete="off"
                        value="{{ej.0.ultima_inspeccion.min_profundidad}}"
                      />
                      <label for="profundidad" class="form__label">
                        Profundidad
                      </label>
                    </div>

                  {% endif %}
                  <!-- End input -->

                  <input id="ids" name="ids" type="text" value={{ej.0.id}} style="display: None">

                  <div>
                    <label for="reemplazar-{{ej.0.id}}" class="input-check">
                      Remplazar
                      <input type="checkbox" value="{{ej.0.id}}" name="reemplazar" id="reemplazar-{{ej.0.id}}"/>
                      <span class="checkmark"></span>
                    </label>
                  </div>

                  <input type="hidden" name="id" value="">
      
                </div>
              {% endfor %}
            {% endfor %}
            {% csrf_token %}
                <nav class="flex-row">
                  <button type="submit" class="btn btn-success" title="Enviar">
                    <span class="icon-checkmark"></span>
                  </button>
                </nav>
              </form>
        </div>
        
      </main>
    </div>

    <script>

      document.addEventListener('DOMContentLoaded', (e) => {
        onSelectTire();
        confirmAlert();
        handleForms();
        handleTire();
      });

      const handleTire = () => {
        const buttons = document.querySelectorAll('.tire');
        const items = document.querySelectorAll('.form__wrapper');

        buttons.forEach((button) => {
          button.addEventListener('click', (e) => {
            const id = button.getAttribute('data-tire-id');

            items.forEach((item) => {
              const itemId = item.getAttribute('data-item-id');
              if (id === itemId) {
                items.forEach((item) => item.classList.remove('select'));

                item.classList.add('select');
              }
            });
          });
        });

      }

      const handleForms = () => {
        const forms = document.querySelectorAll('form');

        forms[0].addEventListener('submit', (e) => {
          if (forms[0].querySelector('input').value === '') {
            e.preventDefault();
            alert('El campo no puede estar vacío');
            forms[0].querySelector('input').focus();
          }
        });
      }

      const confirmAlert = () => {
        const form = document.getElementById('tire-form');

        form.addEventListener('submit', (e) => {
          e.preventDefault();

          const alert = Swal.fire({
            title: 'Confirmación',
            text: '¿Seguro que desea continuar?',
            icon: 'question',
            confirmButtonText: 'Si',
            backdrop: true,
            showDenyButton: true,
            allowOutsideClick: false,
            allowEscapeKey: false,
          }).then(res => {
            (res.value) && form.submit();
          } )
          
        });
      };

      const onSelectTire = () => {
        const tires = document.querySelectorAll('.tire');
        const hidden = document.querySelector("input[type='hidden']");

        tires.forEach(tire => {
          tire.addEventListener('click', (e) => {
            tires.forEach(tire => tire.classList.remove('select'));

            hidden.value = tire.getAttribute('id');

            tire.classList.add('select');
          });
        });
      };
    
    </script>
{% endblock %}
